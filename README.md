# Gradle Example
> gradle-version: 7.0  
> java-version: 11

[![SonarCloud](https://sonarcloud.io/images/project_badges/sonarcloud-orange.svg)](https://sonarcloud.io/dashboard?id=srcmaxim-gradle-example)  
<table style="width:100%">
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:events" rel="nofollow">
        com.example.myproduct.domain:events
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:events" rel="nofollow"><img
            src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:events&metric=sqale_rating"
            alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:events" rel="nofollow"><img
            src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:events&metric=reliability_rating"
            alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:events" rel="nofollow"><img
            src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:events&metric=bugs"
            alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:events" rel="nofollow"><img
            src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:events&metric=code_smells"
            alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:avro-events" rel="nofollow">
        com.example.myproduct.domain:avro-events
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:avro-events" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:avro-events&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:avro-events" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:avro-events&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:avro-events" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:avro-events&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:avro-events" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:avro-events&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:entities" rel="nofollow">
        com.example.myproduct.domain:entities
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:entities" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:entities&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:entities" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:entities&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:entities" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:entities&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.domain:entities" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.domain:entities&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat" rel="nofollow">
        com.example.myproduct.features:cat
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat-api" rel="nofollow">
        com.example.myproduct.features:cat-api
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat-api&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat-api&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat-api&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:cat-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:cat-api&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity" rel="nofollow">
        com.example.myproduct.features:entity
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity-api" rel="nofollow">
        com.example.myproduct.features:entity-api
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity-api&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity-api&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity-api&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.features:entity-api" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.features:entity-api&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
  <tr>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.services:app" rel="nofollow">
        com.example.myproduct.services:app
      </a>
    </td>
    <td>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.services:app" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.services:app&metric=sqale_rating"
          alt="Maintainability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.services:app" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.services:app&metric=reliability_rating"
          alt="Reliability Rating" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.services:app" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.services:app&metric=bugs"
          alt="Bugs" style="max-width:100%;">
      </a>
      <a href="https://sonarcloud.io/dashboard?id=com.example.myproduct.services:app" rel="nofollow"><img
          src="https://sonarcloud.io/api/project_badges/measure?project=com.example.myproduct.services:app&metric=code_smells"
          alt="Code Smells" style="max-width:100%;">
      </a>
    </td>
  </tr>
</table>

[![Build](https://github.com/srcmaxim/gradle-example/actions/workflows/build.yml/badge.svg)](https://github.com/srcmaxim/gradle-example/actions/workflows/build.yml)

[![Docker Repository on Quay](https://quay.io/repository/srcmaxim/gradle-example-app/status "Docker Repository on Quay")](https://quay.io/repository/srcmaxim/gradle-example-app)

> You can open this sample inside an IDE using the [IntelliJ's Gradle import](https://www.jetbrains.com/help/idea/gradle.html#gradle_import_project_start) or [Eclipse Buildship](https://projects.eclipse.org/projects/tools.buildship).  
> You can add [Google CheckStyle config](build-logic/commons/src/main/resources/StyleSources.md) for your IDE.

This sample shows how to structure a software product that consists of multiple components as a set of connected Gradle builds.
As such, it shows how Gradle is used to model a project's architecture and reflect that in the physical structure of the files that make up the software.
This example is described as part of the [documentation on this topic](https://docs.gradle.org/7.0/userguide/structuring_software_products.html).

The product that is built in this sample is an application that displays link: [Gradle Build Tool releases](https://gradle.org/releases/).

There are different ways to work with the sample:

- You may build or import the umbrella build in the root.
  There you can, for example, run the Spring Boot web application via `./gradlew :services:app:bootRun` or build events domain using `./gradlew :domain:events:build`.
- You may only build or import one of the application builds directly.
  For example, `cd services` and run the app using  `../gradlew :app:bootRun`.
- You may only build or import a selected component (and its dependencies).
  For example, only import the `features/cat` in the IDE.

## Setup [SonarCloud](https://sonarcloud.io/)

1. Create an Organization
   1. Organization must match GitHub username
   2. Add SONAR_TOKEN to GitHub security 
2. Setup a Quality Profile:
   1. Go to Administration > New Code > Number of days
   2. Set 30 days
3. Create Projects:
   1. Go to Administration > Projects Management
   2. Create Project\[name=app,key=com.example.myproduct.services:app]
    
## Setup [Quay.io](https://quay.io) Docker registry

1. Create repository for app: gradle-example-app
2. Create User Robot Account with repository write access
3. Add Robot Account DOCKER_USER, DOCKER_TOKEN to GitHub security
    
## Setup CI notifications with [Telegram Bot](https://telegram.org/blog/bot-revolution) and [CloudFlare Workers](https://workers.cloudflare.com/)

Telegram Bot will write to you about CI process.

1. Telegram Bot
  1. Create Telegram Bot from @BotFather bot
  2. Generate TELEGRAM_BOT_TOKEN for your bot
  3. Get your TELEGRAM_USER_ID from @UserIdInfoBot
2. CloudFlare Workers
  1. Create Worker with code provided in /tools/telegram-bot-tool/src/cloudflare-worker.js
  2. Add TELEGRAM_BOT_TOKEN, TELEGRAM_USER_ID as Environment Variables

## Recommended Project Structure

```yml
- aggragegation
  - test-aggregate
  - build-aggregate
- build-logic
  - avro-liblary
  - commons(jacoco, checkstyle, sonarqube)
  - java-liblary
  - report-aggreagation
  - spring-boot-app
  - lambda-app
- domain
  - entity
  - dto
  - avro-event(generated)
  - event
  - mapper(depend on: entity, dto, event)
- platforms
  - plugin-platform
  - product-platform
  - test-platform
- features
  - [name]-feature-api(optional)
  - [name]-feature
- services
  - [name]-service
- lambdas
  - [name]-lambda
- commons(common modules)
  - [name]-common
- tools
  - [name]-tool
- envs
  - local-env
  - aws-env
```

## Commands

|Command||
|:---|---|
|Run app|`./gradlew :services:app:run`
|Build app| `./gradlew :services:app:build`
|Test app|`./gradlew :features:cat:test --continuous`
|Run code coverage <br /> report|`./gradlew :aggregation:test-aggregate:codeCoverageReport`
|Run linter report|`./gradlew :aggregation:test-aggregate:linterReport`
|Run code coverage <br /> and linter reports|`./gradlew :aggregation:test-aggregate:check`
|Clean all|`./gradlew clean`

## Modules:

- com.example.myproduct.services:app
- com.example.myproduct.domain:avro-events
- com.example.myproduct.features:cat
- com.example.myproduct.features:cat-api
- com.example.myproduct.domain:entities
- com.example.myproduct.features:entity
- com.example.myproduct.features:entity-api
- com.example.myproduct.domain:events
